(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{315:function(t,a,s){"use strict";s.r(a);var n=s(1),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("일반적으로 데이터베이스의 Connection을 만드는 과정은 복잡하기 떄문에 비용이 비싸다. 그렇기 때문에 DBCP를 이용하여 때문에  커넥션을 미리 만들어놓고 필요할때마다 가져다 쓰는 방식으로 커넥션을 관리한다.")]),t._v(" "),s("p",[t._v("DBCP는 애플리케이션 성능에 핵심적인 역할을 하며 DBCP에 버그가 존재할 경우 디버깅하기 힘든 심각한 상황이 될 수 있다.")]),t._v(" "),t._m(1),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://github.com/brettwooldridge/HikariCP",target:"_blank",rel:"noopener noreferrer"}},[t._v("HikariCP"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tomcat CP"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://commons.apache.org/proper/commons-dbcp/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Commons DBCP2"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("스프링부트는 HikariCP를 기본으로 선택했다. 여기서는 HikariCP만 살펴보자. "),s("a",{attrs:{href:"https://github.com/brettwooldridge/HikariCP#frequently-used",target:"_blank",rel:"noopener noreferrer"}},[t._v("HikariCP Github"),s("OutboundLink")],1),t._v("에서 HikariCP가 제공하는 다양한 다양한 옵션을 설명한다. 성능 최적화를 위해서는 이러한 옵션들을 상황에 맞게 조절해야한다.")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),s("p",[t._v("HikariCP에 관련된 프로퍼티즈는 HikariDataSource가 상속하고 있는 HikariConfig에서 제공한다. 해당 클래스를 살펴보는 것도 좋지만 문서를 참조하는 것이 가장 좋다.")]),t._v(" "),t._m(5),t._v(" "),s("p",[t._v("간단한 실습으로 스프링부트에 MySQL을 연동해보자.")]),t._v(" "),t._m(6),t._v(" "),t._m(7),s("p",[t._v("먼저 MySQL 커넥터(JDBC가 아니다) 에 대한 의존성이 필요하다.")]),t._v(" "),t._m(8),s("p",[t._v("JDBC URL과 연결정보를 설정한다.")]),t._v(" "),t._m(9),s("p",[s("router-link",{attrs:{to:"/posts/java/spring-data-in-memory-db.html"}},[t._v("인메모리 데이터베이스")]),t._v(" 에서 작성한 러너에서 테스트로 연결정보를 출력하고 쿼리를 전송해보자.")],1),t._v(" "),t._m(10),s("p",[t._v("앱이 실행되면 run 메소드가 호출되면서 테이블과 데이터가 생성된 것을 확인할 수 있다.")]),t._v(" "),t._m(11),t._v(" "),s("p",[t._v("MySQL 5.* 버전")]),t._v(" "),t._m(12),t._v(" "),s("p",[t._v("MySQL 8.* 이후 버전")]),t._v(" "),t._m(13),t._v(" "),s("p",[t._v("allowPublicKeyRetrieval를 true로 설정하는 해결법은 MySQL 라이센스 (GPL)를 주의해야한다. MySQL은 상용 애플리케이션의 경우 엔터프라이즈 라이센스를 갱신하면서 사용해야 한다. 또한, GPL 라이센스를 사용하기 때문에 소스 코드 공개 의무가 있다. 라이센스 비용이 문제가 되는 경우 MySQL 대신 MariaDB 사용할 수 있다.")]),t._v(" "),s("blockquote",[s("p",[t._v("해당 포스팅은 "),s("a",{attrs:{href:"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/",target:"_blank",rel:"noopener noreferrer"}},[t._v("스프링 부트 개념과 활용"),s("OutboundLink")],1),t._v(" 강의 내용을 토대로 작성하였습니다.")])])])},[function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"dbcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dbcp","aria-hidden":"true"}},[this._v("#")]),this._v(" DBCP")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"스프링부트-dbcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#스프링부트-dbcp","aria-hidden":"true"}},[this._v("#")]),this._v(" 스프링부트 DBCP")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[t._v("autoCommit\n"),s("ul",[s("li",[t._v("기본값이 true. true인 경우 commit을 명시하지 않아도 자동으로 SQL 실행 후 commit이 수행된다.")])])]),t._v(" "),s("li",[t._v("connectionTimeout\n"),s("ul",[s("li",[t._v("커넥션 객체를 애플리케이션한테 얼마동안 전달하지 못하면 예외를 던질 것인가에 대한 설정이다.")]),t._v(" "),s("li",[t._v("짧으면 짧을수록 에러가 날 확률이 높기 때문에 적당한 값을 주는 것이 좋다.")]),t._v(" "),s("li",[t._v("기본값은 30이다. 애플리케이션에 커넥션 객체를 30초동안 전달하지 지나서야 예외를 받는다.")])])]),t._v(" "),s("li",[t._v("maximumPoolSize\n"),s("ul",[s("li",[t._v("커넥션 객체를 몇개를 유지할 것인지 결정한다.")]),t._v(" "),s("li",[t._v("커넥션 객체가 많다고해서 전부 실행할 수 있지는 않다.")]),t._v(" "),s("li",[t._v("동시 실행할 수 있는 커넥션 개수는 CPU 코어 개수와 같다. 코어 개수가 넘어간 커넥션(쓰레드)들은 대기 상태에 있게된다.")])])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"스프링부트-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#스프링부트-설정","aria-hidden":"true"}},[this._v("#")]),this._v(" 스프링부트 설정")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[this._v("spring.datasource.hikari.maxmimum-pool-size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[this._v("4 # PC의 local 코어가 2개라 pool-size를 4개로 설정했다")]),this._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"mysql-실습"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-실습","aria-hidden":"true"}},[this._v("#")]),this._v(" MySQL 실습")])},function(){var t=this.$createElement,a=this._self._c||t;return a("blockquote",[a("p",[this._v("도커: MySQL 설치 & 실행")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("docker run -p 3306:3306 –name mysql_boot -e MYSQL_ROOT_PASSWORD=1 -e MYSQL_DATABASE=springboot -e MYSQL_USER=keesun -e MYSQL_PASSWORD=pass -d mysql\n\ndocker exec -i -t mysql_boot bash\n\nmysql -u root -p\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("mysql-connector-java"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.datasource.url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("jdbc:mysql://192.168.99.100:3306/springboot")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.datasource.username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("jch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.datasource.password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("pass")]),t._v("\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MySQLRunner")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApplicationRunner")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    DataSource dataSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    JdbcTemplate jdbcTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ApplicationArguments args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" Exception "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Connection connection "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dataSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConnection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==============="')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMetaData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getURL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMetaData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            Statement statement "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createStatement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            String sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CREATE TABLE USER(ID INTEGER NOT NULL, name VARCHAR(255), PRIMARY KEY (id))"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            statement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeUpdate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        jdbcTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"INSERT INTO USER VALUES (1, 'jch')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"mysql-접속시-에러-ssl-관련-경고"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-접속시-에러-ssl-관련-경고","aria-hidden":"true"}},[this._v("#")]),this._v(" MySQL 접속시 에러(SSL 관련 경고)")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("table",[s("thead",[s("tr",[s("th",[t._v("문제")]),t._v(" "),s("th",[t._v("Sat Jul 21 11:17:59 PDT 2018 WARN: Establishing SSL connection without server’s identity verification is not recommended. "),s("strong",[t._v("According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn’t set.")]),t._v(" For compliance with existing applications not using SSL the "),s("strong",[t._v("verifyServerCertificate property is set to ‘false’")]),t._v(". You need either to explicitly disable SSL by setting "),s("strong",[t._v("useSSL=false")]),t._v(", or set "),s("strong",[t._v("useSSL=true and provide truststore")]),t._v(" for server certificate verification.")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("해결")]),t._v(" "),s("td",[t._v("jdbc:mysql:/localhost:3306/springboot?**useSSL=false ** 같이 SSL 접속을 false로 설정한다.")])])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("table",[s("thead",[s("tr",[s("th",[t._v("문제")]),t._v(" "),s("th",[t._v("com.mysql.jdbc.exceptions.jdbc4.MySQLNonTransientConnectionException: Public Key Retrieval is not allowed")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("해결")]),t._v(" "),s("td",[t._v("jdbc:mysql:/localhost:3306/springboot?useSSL=false&"),s("strong",[t._v("allowPublicKeyRetrieval=true")])])])])])}],!1,null,null,null);e.options.__file="spring-data-dbcp-mysql.md";a.default=e.exports}}]);